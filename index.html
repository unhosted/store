<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8" />
    <meta name="description" content="example unhosted web apps" />
    <title>unhosted web apps: example apps</title>
    <link rel="stylesheet" href="store.css" />
  </head>

  <body>
    <article>
      <p style="margin-bottom:3em">
        <input type="button" id="install-button" value="INSTALL NEW APPS" onclick="toggleShowInstall();" />
        <a href="https://github.com/unhosted/store#add"><strong>+ add your app to the store</strong></a> Connect to sync -></p>
      </p>
      <ul class="icons install hidden" id="apps-install">
        <p>(no apps yet)</p>
      </ul>
      <ul class="icons" id="apps-list">
        <p>(no apps yet)</p>
      </ul>
    </article>      
  </body>
  <script src="remotestorage.js"></script>
  <script src="apps.js"></script>
  <script>
    function createLi(key, obj, userAddress) {
      var launchParam = '', uninstallButton = '';
      if (userAddress) {
        launchParam = '#remotestorage='+encodeURIComponent(userAddress);
        uninstallButton = ' (<a onclick="uninstallApp(\''+obj.name+'\');">X</a>)';
      }
      return '<li>'
        +(obj.img === 'none' ? '' :
          '<a href="'
          +obj.href+launchParam+'"><img src="'
          +obj.img+'" /></a>'
        )
        +'<p><a href="'
        +obj.href+launchParam+'">'
        +obj.name+'</a>'
        +uninstallButton+'</p></li>';
    }
    function createInstallLi(key, obj, userAddress) {
      return '<li onclick="installApp(\''+obj.name+'\');">'
        +(obj.img === 'none' ? '' :
          '<img src="'
          +obj.img+'" />'
        )
        +'<p>'
        +obj.name
        +'</p></li>';
    }
    function refreshList(apps, userAddress) {
      var innerHTML = '';
      for(var entry in apps) {
        innerHTML += createLi(entry, apps[entry], userAddress);
      }
      document.getElementById('apps-list').innerHTML = innerHTML;
    }
    function refreshInstallList(apps, userAddress) {
      var innerHTML = '';
      for(var entry in apps) {
        innerHTML += createInstallLi(entry, apps[entry], userAddress);
      }
      document.getElementById('apps-install').innerHTML = innerHTML;
    }
    function toggleShowInstall() {
      var classList = document.getElementById('apps-install').classList
      classList.toggle('hidden');
      if (classList.contains('hidden')) {
        document.getElementById('install-button').value = 'INSTALL NEW APPS'; 
      } else {
        document.getElementById('install-button').value = 'DONE'; 
      }
    }
    function hideInstall() {
      document.getElementById('apps-install').
      document.getElementById('apps-install').classList.add('hidden');
    }
    function installApp(name) {
      remoteStorage.apps.installApp(name);
    }
    function uninstallApp(name) {
      remoteStorage.apps.uninstallApp(name);
    }
    function init() {
      RemoteStorage.config.logging = true;
      remoteStorage.access.claim('apps', 'rw');
      remoteStorage.displayWidget();
      remoteStorage.apps.onChange(function(apps) {
        refreshList(apps, remoteStorage.remote.userAddress);
        refreshInstallList(remoteStorage.apps.getAvailableApps());
      });
      refreshInstallList(remoteStorage.apps.getAvailableApps());
    }
    //...
    init();
  </script>
</html>