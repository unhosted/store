<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8" />
    <meta name="description" content="example unhosted web apps" />
    <title>unhosted web apps: example apps</title>
    <link rel="stylesheet" href="adventures.css" />
  </head>

  <body>
    <article>
      <p style="margin-bottom:3em">
        <a href="https://github.com/unhosted/store"><strong>+ add yours</strong></a> Connect to customize -></p>
      </p>
      <ul class="icons" id="apps-list">
      </ul>
    </article>      
  </body>
  <script src="remotestorage.js"></script>
  <script src="apps.js"></script>
  <script>    
    function createLi(key, obj, userAddress) {
      var launchParam = '', removeButton = '';
      if (userAddress) {
        launchParam = '#remotestorage='+encodeURIComponent(userAddress);
        removeButton = ' (<a onclick="removeApp(\''+obj.name+'\');">X</a>)';
      }
      return '<li>'
        +(obj.img === 'none' ? '' :
          '<a href="'
          +obj.href+launchParam+'"><img src="'
          +obj.img+'" /></a>'
        )
        +'<p><a href="'
        +obj.href+launchParam+'">'
        +obj.name+'</a>'
        +removeButton+'</p></li>';
    }
    function refreshList(apps, userAddress) {
      var innerHTML = '';
      for(var entry in apps) {
        innerHTML += createLi(entry, apps[entry], userAddress);
      }
      document.getElementById('apps-list').innerHTML = innerHTML;
    }
    function removeApp(name) {
      remoteStorage.scope('/apps/').remove(name);
    }
    function init() {
      RemoteStorage.config.logging = true;
      remoteStorage.access.claim('apps', 'rw');
      remoteStorage.displayWidget();
      remoteStorage.apps.onChange(function(apps) {
        refreshList(apps, remoteStorage.remote.userAddress);
      });
    }
    //...
    init();
  </script>
</html>